<!DOCTYPE html>

<html lang="es" xmlns:th="http://www.thymeleaf.org">



<head>

	<meta charset="UTF-8">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Registro de Pago | CodiPlayCo</title>



	<link
		href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Rubik:wght@400;500;700&family=Quicksand:wght@500;700&display=swap"
		rel="stylesheet" />

	<link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet" />



	<link th:href="@{/assets/estilosinicio.css}" rel="stylesheet" />

	<link th:href="@{/assets/estilosmetodo.css}" rel="stylesheet" />

	<link th:href="@{/assets/estilosregistropago.css}" rel="stylesheet" />



	<script src="https://js.stripe.com/v3/"></script>



</head>



<body>



	<!-- LOGO -->

	<div class="logo-corner">

		<a th:href="@{/}">

			<img th:src="@{/assets/imag/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png}" alt="CodiPlayCo Logo"
				class="logo-animate h-36 w-auto md:h-48 max-w-[420px]" />

		</a>

	</div>



	<main class="main-form-bg">

		<div class="form">



			<div class="form-title">Registro de pago</div>

			<div class="title-2"><span>CodiPlayCo</span></div>



			<form id="form-registro">



				<div class="input-container">

					<label>Nombre</label>

					<input type="text" id="nombre" required placeholder="Nombre"/>

				</div>

				<div class="input-container">

					<label>Apellido</label>

					<input type="text" id="apellido" required placeholder="Apellidos" />

				</div>


				<div class="input-container">

					<label>Tipo Documento</label>

					<input type="text" id="tipoDocumento" required placeholder="Tipo Documento"/>

				</div>
				<div class="input-container">

					<label>Documento</label>

					<input type="text" id="documento" required placeholder="Numero Documento" />

				</div>

				<div class="input-container">

					<label>Correo electrónico</label>

					<input type="email" id="email" required placeholder="E-mail" />

				</div>

				<div class="input-container"> <label for="password"> Contraseña</label>
									<div style="position:relative; width:320px;"> <input id="password" type="password"
											 placeholder="Crea una contraseña" required
											style="padding-right:2.5rem; width:320px;" />
										<span class="material-icons toggle-password" id="togglePassword"
											style="position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; color:#111; user-select:none; font-size:1.5rem; background:transparent;">
											visibility_off </span>
									</div>

				<div class="input-container">

					<label>Curso</label>
					<input id="curso" th:value="${curso.curso}" disabled />

				</div>



				<div class="input-container">

					<label>Número de teléfono</label>

					<input type="tel" id="telefono" required placeholder="Telefono" />

				</div>

				<input type="hidden" id="cursoId" th:value="${curso.id}" />
				<input type="hidden" id="cursoNombre" th:value="${curso.curso}" />
				<input type="hidden" id="cursoPrecio" th:value="${curso.precio}" />

				<button type="submit">Registrar e ir al Pago</button>

			</form>



		</div>

	</main>







	<!-- SCRIPT -->

	<script>
		(function () {
			let registroId = null;

			document.getElementById("form-registro").addEventListener("submit", async (e) => {
				e.preventDefault();
				// 1) Guardar registro
				const registro = {
					nombre: document.getElementById("nombre").value,
					apellido: document.getElementById("apellido").value,
					tipoDocumento: document.getElementById("tipoDocumento").value,
					documento: document.getElementById("documento").value,
					email: document.getElementById("email").value,
					telefono: document.getElementById("telefono").value,
					cursoId: parseInt(document.getElementById("cursoId").value),
					cursoNombre: document.getElementById("cursoNombre").value,
					precio: parseInt(document.getElementById("cursoPrecio").value),
					estadoPago: "pendiente",
					password: document.getElementById("password").value
				};

				const res = await fetch('/api/registro/guardar', {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify(registro)
				});

				const regData = await res.json();
				registroId = regData.id;
				
				// Redirigir a la página de pago con los datos necesarios en la URL
				const params = new URLSearchParams({
					registroId: registroId,
					cursoNombre: registro.cursoNombre,
					precio: registro.precio.toString(),
					nombre: registro.nombre,
					email: registro.email,
					telefono: registro.telefono
				});
				window.location.href = '/pago?' + params.toString();

			});

		})();
	</script>



</body>



</html>