<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title></title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap">
	<link rel="stylesheet" th:href="@{/assetsDocente/stylespanel.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
</head>

<body>
	<nav>
		<div class="nav-logo">
			<img th:src="@{/assetsDocente/img/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png}" alt="CodiPlayCo Logo" />
		</div>
		<button class="toggle-mode-btn" title="Cambiar modo"
			style="margin:0 auto 0.5rem auto; display:block; background:#fff2; border:none; color:#fff; font-size:1.7rem; border-radius:50%; width:44px; height:44px; box-shadow:0 2px 8px #0002; cursor:pointer; transition:background 0.2s, color 0.2s; display:flex; align-items:center; justify-content:center;"><i
				class="fa-solid fa-moon"></i></button>
		<a th:href="@{/InterfazDocente/paneldocente}"><span class="nav-icon"><i
					class="fa-solid fa-house"></i></span>Inicio</a>
		<a th:href="@{/InterfazDocente/mis-cursos}"><span class="nav-icon"><i class="fa-solid fa-book"></i></span>Mis
			Cursos</a>
		<a th:href="@{/InterfazDocente/tareas}"><span class="nav-icon"><i
					class="fa-solid fa-clipboard-list"></i></span>Tareas</a>
		<a th:href="@{/InterfazDocente/foros}"><span class="nav-icon"><i
					class="fa-solid fa-comments"></i></span>Foros</a>
		<a th:href="@{/InterfazDocente/mensajes}"><span class="nav-icon"><i
					class="fa-solid fa-envelope"></i></span>Mensajes</a>

	</nav>
	<div class="main-layout">
		<header>
			<div class="header-logo-title">
				<h1 class="titulo-blanco"><span class="panel-icon"><i class="fa-solid fa-book"></i></span>Mis Cursos
				</h1>
			</div>
			<div class="topbar-right">
				<!-- Botón de modo oscuro eliminado del header -->
				<div class="notificaciones" title="Notificaciones"><i class="fa-solid fa-bell"></i></div>
				<div class="perfil">
					<i class="fa-solid fa-user"></i>
					<span th:if="${docente != null}" th:text="${docente.nombre}">Docente</span>
					<span th:if="${docente == null}">Docente</span>
					<div class="submenu">
						<p th:if="${docente != null}"><strong>Nombre:</strong> <span
								th:text="${docente.nombre + ' ' + docente.apellido}">Nombre Completo</span></p>
						<p th:if="${docente == null}"><strong>Nombre:</strong> No disponible</p>
						<p><strong>Rol:</strong> Docente</p>

						<a th:href="@{/InterfazDocente/logout}" style="color: inherit; text-decoration: none;">
							<button><i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión</button>
						</a>
					</div>
				</div>
		</header>
		<script>
			// Mantener modo oscuro con localStorage
			function setDarkMode(enabled) {
				if (enabled) {
					document.body.classList.add('dark-mode');
					localStorage.setItem('theme', 'dark-mode');
				} else {
					document.body.classList.remove('dark-mode');
					localStorage.setItem('theme', 'light-mode');
				}
			}
			// Al cargar la página, aplicar preferencia
			(function () {
				const theme = localStorage.getItem('theme');
				if (theme === 'dark-mode') {
					document.body.classList.add('dark-mode');
					const btn = document.querySelector('.toggle-mode-btn');
					if (btn) {
						const icon = btn.querySelector('i');
						icon.classList.remove('fa-moon');
						icon.classList.add('fa-sun');
					}
				}
			})();
			// Alternar icono luna/sol y modo oscuro
			const btn = document.querySelector('.toggle-mode-btn');
			if (btn) btn.addEventListener('click', function () {
				const icon = btn.querySelector('i');
				const isDark = !document.body.classList.contains('dark-mode');
				setDarkMode(isDark);
				if (isDark) {
					icon.classList.remove('fa-moon');
					icon.classList.add('fa-sun');
				} else {
					icon.classList.remove('fa-sun');
					icon.classList.add('fa-moon');
				}
			});
		</script>
		<script>
			// Menú desplegable responsive
			const nav = document.getElementById('sidebarNav');
			const navToggle = document.getElementById('navToggle');
			const navOverlay = document.getElementById('navOverlay');
			if (nav && navToggle && navOverlay) {
				navToggle.addEventListener('click', () => {
					nav.classList.toggle('open');
					navOverlay.classList.toggle('active');
				});
				navOverlay.addEventListener('click', () => {
					nav.classList.remove('open');
					navOverlay.classList.remove('active');
				});
			}
		</script>

			<div class="panel" th:if="${cursos == null or #lists.isEmpty(cursos)}">
				<h2><span class="panel-icon"><i class="fa-solid fa-chart-line"></i></span>Curso Asignado</h2>
				<p>No tienes cursos asignados actualmente.</p>
			</div>

			<div th:each="curso : ${cursos}" class="panel">
				<h2><span class="panel-icon"><i class="fa-solid fa-chart-line"></i></span>
					<span th:text="${curso.curso}">Nombre del curso</span>
				</h2>

				<div th:if="${#maps.containsKey(progresoPorCurso, curso.id)}">
					<h3>Progreso General de Estudiantes</h3>
					<table class="tabla-progreso">
						<thead>
							<tr>
								<th>Estudiante</th>
								<th>Progreso</th>
								<th>Estado</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="p : ${progresoPorCurso[curso.id]}">
								<td th:text="${p.nombreCompleto}">Nombre estudiante</td>
								<td>
									<div class="progreso-container">
										<span class="progreso-percentage" th:text="${#numbers.formatDecimal(p.porcentaje, 0, 2)} + ' %'">0%</span>
										<div class="barra-progreso">
											<div class="progreso" th:style="'width:' + ${p.porcentaje} + '%;'" 
												 th:classappend="${p.porcentaje >= 100 ? 'completado' : (p.porcentaje >= 50 ? 'medio' : 'bajo')}"></div>
										</div>
									</div>
								</td>
								<td>
									<span th:if="${p.porcentaje >= 100}" class="estado-completado">
										<i class="fas fa-check-circle"></i> Completado
									</span>
									<span th:if="${p.porcentaje >= 50 and p.porcentaje < 100}" class="estado-progreso">
										<i class="fas fa-spinner"></i> En progreso
									</span>
									<span th:if="${p.porcentaje < 50}" class="estado-inicial">
										<i class="fas fa-clock"></i> Iniciando
									</span>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<!-- Progreso detallado por módulo y lección -->
				<div th:if="${#maps.containsKey(progresoModulosPorCurso, curso.id)}" style="margin-top: 2rem;">
					<h3>Progreso Detallado por Módulo</h3>
					<table class="tabla-progreso tabla-detallada">
						<thead>
							<tr>
								<th>Estudiante</th>
								<th>Módulo Actual</th>
								<th>Lección Actual</th>
								<th>Progreso del Módulo</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="pDet : ${progresoModulosPorCurso[curso.id]}">
								<td th:text="${pDet.nombreCompleto}">Nombre estudiante</td>
								<td>
									<span th:if="${pDet.moduloActual != null}" class="modulo-actual" th:text="'Módulo ' + ${pDet.moduloActual}">Módulo 1</span>
									<span th:if="${pDet.moduloActual == null}" class="sin-progreso">Sin iniciar</span>
								</td>
								<td>
									<span th:if="${pDet.leccionActual != null}" class="leccion-actual" th:text="'Lección ' + ${pDet.leccionActual}">Lección 1</span>
									<span th:if="${pDet.leccionActual == null}" class="sin-progreso">Sin iniciar</span>
								</td>
								<td>
									<div th:if="${pDet.moduloActual != null}" class="progreso-modulo">
										<span th:each="leccion : ${#numbers.sequence(1, #maps.containsKey(leccionesPorModulo, pDet.moduloActual) ? leccionesPorModulo[pDet.moduloActual] : 1)}" 
											  th:class="${leccion <= pDet.leccionActual ? 'leccion-completada' : 'leccion-pendiente'}"
											  th:title="'Lección ' + ${leccion}">
											<span th:text="${leccion}"></span>
										</span>
									</div>
									<span th:if="${pDet.moduloActual == null}" class="sin-progreso">0%</span>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div th:if="${!#maps.containsKey(progresoPorCurso, curso.id) || #lists.isEmpty(progresoPorCurso[curso.id])}"
					 class="no-estudiantes">
					<i class="fas fa-user-graduate"></i>
					<p>No hay estudiantes inscritos en este curso todavía.</p>
					<p class="info">Los estudiantes aparecerán aquí una vez que se inscriban y paguen por el curso.</p>
				</div>
			</div>
		</div>
	</div>
</body>

</html>
