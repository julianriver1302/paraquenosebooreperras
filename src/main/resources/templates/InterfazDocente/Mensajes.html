<!DOCTYPE html>
<html lang="es" xmlns:th="http://thymeLeaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title></title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
	<link rel="stylesheet" th:href="@{/assetsDocente/stylespanel.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
	<link rel="stylesheet" th:href="@{/assetsDocente/css/mensajes.css}" />
	<style>
		/* Estilos inline mínimos para el funcionamiento inicial */
		.tab-content { display: none; }
		.tab-content.active { display: block; }
	</style>
</head>

<body>
	<nav>
		<div class="nav-logo">
			<img th:src="@{/assetsDocente/img/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png}" alt="CodiPlayCo Logo" />
		</div>
		<button class="toggle-mode-btn" title="Cambiar modo"
			style="margin:0 auto 0.5rem auto; display:block; background:#fff2; border:none; color:#fff; font-size:1.7rem; border-radius:50%; width:44px; height:44px; box-shadow:0 2px 8px #0002; cursor:pointer; transition:background 0.2s, color 0.2s; display:flex; align-items:center; justify-content:center;"><i
				class="fa-solid fa-moon"></i></button>
		<a th:href="@{/InterfazDocente/paneldocente}"><span class="nav-icon"><i
					class="fa-solid fa-house"></i></span>Inicio</a>
		<a th:href="@{/InterfazDocente/mis-cursos}"><span class="nav-icon"><i class="fa-solid fa-book"></i></span>Mis
			Cursos</a>
		<a th:href="@{/InterfazDocente/tareas}"><span class="nav-icon"><i
					class="fa-solid fa-clipboard-list"></i></span>Tareas</a>
		<a th:href="@{/InterfazDocente/foros}"><span class="nav-icon"><i
					class="fa-solid fa-comments"></i></span>Foros</a>
		<a th:href="@{/InterfazDocente/mensajes}"><span class="nav-icon"><i
					class="fa-solid fa-envelope"></i></span>Mensajes</a>

	</nav>
	<div class="main-layout">
		<header>

			<div class="header-logo-title">
				<h1 class="titulo-blanco"><span class="panel-icon"><i class="fa-solid fa-envelope"></i></span>Mensajes</h1>
			</div>
			<div class="topbar-right">
				<div class="notificaciones" title="Notificaciones"><i class="fa-solid fa-bell"></i></div>
				<div class="perfil">
					<i class="fa-solid fa-user"></i>
					<span th:if="${docente != null}" th:text="${docente.nombre}">Docente</span>
					<span th:if="${docente == null}">Docente</span>
					<div class="submenu">
						<p th:if="${docente != null}"><strong>Nombre:</strong> <span th:text="${docente.nombre + ' ' + docente.apellido}">Nombre Completo</span></p>
						<p th:if="${docente == null}"><strong>Nombre:</strong> No disponible</p>
						<p><strong>Rol:</strong> Docente</p>
						<a th:href="@{/InterfazDocente/logout}" style="color: inherit; text-decoration: none;">
							<button><i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión</button>
						</a>
					</div>
				</div>
			</div>
		</header>
		<div class="container">
			<div class="panel">
				<div class="panel-header">
					<h2><span class="panel-icon"><i class="fa-solid fa-envelope"></i></span> Centro de mensajes</h2>
					<div class="tabs-mensajes">
						<button class="tab-btn active" data-tab="tab-enviar">
							<i class="fas fa-paper-plane"></i> Enviar mensaje
						</button>
						<button class="tab-btn" data-tab="tab-enviados">
							<i class="fas fa-share-square"></i> Enviados
						</button>
						<button class="tab-btn" data-tab="tab-recibidos">
							<i class="fas fa-inbox"></i> Recibidos
						</button>
					</div>
				</div>
				<div id="tab-enviar" class="tab-content active">
					<div class="form-container">
						<form th:action="@{/InterfazDocente/mensajes/enviar}" method="post" class="message-form">
							<div class="form-group">
								<label for="destinatarioId">Para:</label>
								<select id="destinatarioId" name="destinatarioId" class="form-control" required>
									<option value="" disabled selected>Seleccione un estudiante</option>
									<option th:each="estudiante : ${estudiantes}"
											th:value="${estudiante.id}"
											th:text="${estudiante.nombre + ' ' + estudiante.apellido}">
										Estudiante
									</option>
								</select>
							</div>
							<div class="form-group">
								<label for="contenido">Mensaje:</label>
								<textarea id="contenido" name="contenido" rows="5" class="form-control" 
									  placeholder="Escribe tu mensaje..." required></textarea>
							</div>
							<div class="form-actions">
								<button type="submit" class="btn btn-primary">
									<i class="fas fa-paper-plane"></i> Enviar Mensaje
								</button>
							</div>
						</form>
					</div>
				</div>
				<div id="tab-enviados" class="tab-content">
					<div class="messages-header">
						<h3><i class="fas fa-share-square"></i> Mensajes Enviados</h3>
					</div>
					<div th:if="${#lists.isEmpty(mensajesEnviados)}" class="no-messages">
						<i class="far fa-paper-plane fa-3x"></i>
						<p>No has enviado mensajes todavía.</p>
					</div>
					<ul th:if="${!#lists.isEmpty(mensajesEnviados)}" class="lista-mensajes">
						<li th:each="m : ${mensajesEnviados}">
							<strong th:text="${m.destinatario.nombre + ' ' + m.destinatario.apellido}">Destinatario</strong>
							<span th:text="${#temporals.format(m.fechaEnvio, 'dd/MM/yyyy HH:mm')}">Fecha</span>
							<p th:text="${m.contenido}">Contenido</p>
						</li>
					</ul>
				</div>
				<div id="tab-recibidos" class="tab-content">
					<div class="messages-header">
						<h3><i class="fas fa-inbox"></i> Mensajes Recibidos</h3>
					</div>
					<div th:if="${#lists.isEmpty(mensajesRecibidos)}" class="no-messages">
						<i class="far fa-envelope fa-3x"></i>
						<p>No tienes mensajes recibidos.</p>
					</div>
					<ul th:if="${!#lists.isEmpty(mensajesRecibidos)}" class="lista-mensajes">
						<li th:each="m : ${mensajesRecibidos}">
							<strong th:text="${m.remitente.nombre + ' ' + m.remitente.apellido}">Remitente</strong>
							<span th:text="${#temporals.format(m.fechaEnvio, 'dd/MM/yyyy HH:mm')}">Fecha</span>
							<p th:text="${m.contenido}">Contenido</p>
						</li>
					</ul>
				</div>
			</div>
		</div>

	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
			// Mantener modo oscuro con localStorage
			function setDarkMode(enabled) {
				if (enabled) {
					document.body.classList.add('dark-mode');
					localStorage.setItem('theme', 'dark-mode');
				} else {
					document.body.classList.remove('dark-mode');
					localStorage.setItem('theme', 'light-mode');
				}
			}

			// Aplicar tema al cargar
			function applyTheme() {
				const theme = localStorage.getItem('theme');
				const isDark = theme === 'dark-mode' || 
					(theme === null && window.matchMedia('(prefers-color-scheme: dark)').matches);
				
				setDarkMode(isDark);
				
				const btn = document.querySelector('.toggle-mode-btn');
				if (btn) {
					const icon = btn.querySelector('i');
					icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
				}
			}

			// Alternar modo oscuro
			const btn = document.querySelector('.toggle-mode-btn');
			if (btn) {
				btn.addEventListener('click', function() {
					const isDark = !document.body.classList.contains('dark-mode');
					setDarkMode(isDark);
					const icon = btn.querySelector('i');
					icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
				});
			}

			// Inicializar tabs
			function initTabs() {
				const tabButtons = document.querySelectorAll('.tab-btn');
				const tabContents = document.querySelectorAll('.tab-content');
				
				if (tabButtons.length === 0 || tabContents.length === 0) return;

				// Función para cambiar de pestaña
				function switchTab(targetId) {
					tabButtons.forEach(btn => {
						if (btn.getAttribute('data-tab') === targetId) {
							btn.classList.add('active');
						} else {
							btn.classList.remove('active');
						}
					});

					tabContents.forEach(content => {
						content.style.display = 'none';
						content.classList.remove('active');
						
						if (content.id === targetId) {
							content.style.display = 'block';
							content.classList.add('active');
							setTimeout(() => content.style.opacity = '1', 10);
						} else {
							content.style.opacity = '0';
							setTimeout(() => {
								content.style.display = 'none';
							}, 200);
						}
					});
				}

				// Manejar clic en las pestañas
				tabButtons.forEach(btn => {
					btn.addEventListener('click', () => {
						const targetId = btn.getAttribute('data-tab');
						switchTab(targetId);
						// Guardar la pestaña activa
						sessionStorage.setItem('activeTab', targetId);
					});
				});

				// Restaurar pestaña activa si existe
				const activeTab = sessionStorage.getItem('activeTab');
				if (activeTab && document.getElementById(activeTab)) {
					switchTab(activeTab);
				}
			}

			// Inicializar
			applyTheme();
			initTabs();

			// Mejorar accesibilidad de los tabs
			document.querySelectorAll('.tab-btn').forEach((btn, index, array) => {
				btn.setAttribute('role', 'tab');
				btn.setAttribute('aria-selected', index === 0 ? 'true' : 'false');
				btn.setAttribute('tabindex', index === 0 ? '0' : '-1');
				
				// Navegación con teclado
				btn.addEventListener('keydown', (e) => {
					if (e.key === 'Enter' || e.key === ' ') {
						e.preventDefault();
						btn.click();
					} else if (e.key === 'ArrowRight') {
						const next = array[(index + 1) % array.length];
						next.focus();
						e.preventDefault();
					} else if (e.key === 'ArrowLeft') {
						const prev = array[(index - 1 + array.length) % array.length];
						prev.focus();
						e.preventDefault();
					} else if (e.key === 'Home') {
						array[0].focus();
						e.preventDefault();
					} else if (e.key === 'End') {
						array[array.length - 1].focus();
						e.preventDefault();
					}
				});
			});
		});
	</script>

</body>

</html>