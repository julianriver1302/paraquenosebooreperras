<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title></title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap">
	<link rel="stylesheet" th:href="@{/assetsDocente/stylespanel.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
</head>

<body>
	<nav>
		<div class="nav-logo">
			<img th:src="@{/assetsDocente/img/ChatGPT Image 4 jul 2025, 02_22_14 p.m..png}" alt="CodiPlayCo Logo" />
		</div>
		<button class="toggle-mode-btn" title="Cambiar modo"
			style="margin:0 auto 0.5rem auto; display:block; background:#fff2; border:none; color:#fff; font-size:1.7rem; border-radius:50%; width:44px; height:44px; box-shadow:0 2px 8px #0002; cursor:pointer; transition:background 0.2s, color 0.2s; display:flex; align-items:center; justify-content:center;"><i
				class="fa-solid fa-moon"></i></button>
		<a th:href="@{/InterfazDocente/paneldocente}"><span class="nav-icon"><i
					class="fa-solid fa-house"></i></span>Inicio</a>
		<a th:href="@{/InterfazDocente/mis-cursos}"><span class="nav-icon"><i class="fa-solid fa-book"></i></span>Mis
			Cursos</a>
		<a th:href="@{/InterfazDocente/tareas}"><span class="nav-icon"><i
					class="fa-solid fa-clipboard-list"></i></span>Tareas</a>
		<a th:href="@{/InterfazDocente/foros}"><span class="nav-icon"><i
					class="fa-solid fa-comments"></i></span>Foros</a>
		<a th:href="@{/InterfazDocente/mensajes}"><span class="nav-icon"><i
					class="fa-solid fa-envelope"></i></span>Mensajes</a>
		
	</nav>
	<div class="main-layout">
		<header>
			<div class="header-logo-title">
				<h1 class="titulo-blanco"><span class="panel-icon"><i class="fa-solid fa-comments"></i></span>Foros</h1>
			</div>
			<div class="topbar-right">
				<div class="notificaciones" title="Notificaciones"><i class="fa-solid fa-bell"></i></div>
				<div class="perfil">
					<i class="fa-solid fa-user"></i> Docente
					<div class="submenu">
						<p><strong>Nombre:</strong></p>
						<p><strong>Rol:</strong> Docente</p>
						<button><i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión</button>
					</div>
				</div>
			</div>
		</header>
		<div class="container">
			<div class="panel">
				<h2><span class="panel-icon"><i class="fa-solid fa-comment-dots"></i></span> Crear Foro</h2>
				<form th:action="@{/InterfazDocente/foros/crear}" method="post" class="form-foro">
					<label for="titulo">Tema:</label>
					<input id="titulo" name="titulo" type="text" placeholder="Ej: Ideas para nuevos juegos" required>
					<label for="cursoId">Curso:</label>
					<select id="cursoId" name="cursoId" required>
						<option value="" disabled selected>Selecciona un curso</option>
						<option th:each="curso : ${cursos}"
						        th:value="${curso.id}"
						        th:text="${curso.curso}">Curso</option>
					</select>
					<label for="descripcion">Descripción:</label>
					<textarea id="descripcion" name="descripcion" rows="3" required></textarea>
					<button type="submit">Crear Foro</button>
				</form>
			</div>

			<div class="panel" th:if="${cursos != null}">
				<h2><span class="panel-icon"><i class="fa-solid fa-list"></i></span> Foros creados</h2>
				<div th:each="curso : ${cursos}" class="foro-curso-bloque">
					<h3 th:text="${curso.curso}">Nombre curso</h3>
					<div th:if="${#maps.containsKey(forosPorCurso, curso.id) and !#lists.isEmpty(forosPorCurso[curso.id])}">
						<ul class="lista-foros">
							<li th:each="foro : ${forosPorCurso[curso.id]}" class="foro-item">
								<div class="foro-header">
									<strong th:text="${foro.titulo}">Título foro</strong>
									<div class="foro-actions">
										<button class="btn-editar" 
												title="Editar foro"
												th:data-id="${foro.id}"
												th:data-titulo="${foro.titulo}"
												th:data-descripcion="${foro.descripcion}">
											<i class="fas fa-edit"></i>
										</button>
									</div>
								</div>
								<p th:text="${foro.descripcion}">Descripción</p>
								<small th:text="${#temporals.format(foro.fechaCreacion, 'dd/MM/yyyy HH:mm')}">Fecha</small>
							</li>
						</ul>
					</div>
					<div th:if="${!#maps.containsKey(forosPorCurso, curso.id) || #lists.isEmpty(forosPorCurso[curso.id])}">
						<p>No hay foros para este curso.</p>
					</div>
				</div>
			</div>

			<!-- Modal para editar foro -->
			<div id="editarForoModal" class="modal">
				<div class="modal-content">
					<span class="close-modal">&times;</span>
					<h3>Editar Foro</h3>
					<form th:action="@{/InterfazDocente/foros/editar}" method="post" id="formEditarForo">
						<input type="hidden" id="editarForoId" name="foroId">
						<div class="form-group">
							<label for="editarTitulo">Tema:</label>
							<input type="text" id="editarTitulo" name="titulo" required>
						</div>
						<div class="form-group">
							<label for="editarDescripcion">Descripción:</label>
							<textarea id="editarDescripcion" name="descripcion" rows="3" required></textarea>
						</div>
						<button type="submit" class="btn-guardar">
							<i class="fas fa-save"></i> Guardar Cambios
						</button>
					</form>
				</div>
			</div>
		</div>
	</div>
	<script>
		// Mantener modo oscuro con localStorage
		function setDarkMode(enabled) {
			if (enabled) {
				document.body.classList.add('dark-mode');
				localStorage.setItem('theme', 'dark-mode');
			} else {
				document.body.classList.remove('dark-mode');
				localStorage.setItem('theme', 'light-mode');
			}
		}
		// Al cargar la página, aplicar preferencia
		(function () {
			const theme = localStorage.getItem('theme');
			if (theme === 'dark-mode') {
				document.body.classList.add('dark-mode');
				const btn = document.querySelector('.toggle-mode-btn');
				if (btn) {
					const icon = btn.querySelector('i');
					icon.classList.remove('fa-moon');
					icon.classList.add('fa-sun');
				}
			}
		})();
		// Alternar icono luna/sol y modo oscuro
		const btn = document.querySelector('.toggle-mode-btn');
		if (btn) btn.addEventListener('click', function () {
			const icon = btn.querySelector('i');
			const isDark = !document.body.classList.contains('dark-mode');
			setDarkMode(isDark);
			if (isDark) {
				icon.classList.remove('fa-moon');
				icon.classList.add('fa-sun');
			} else {
				icon.classList.remove('fa-sun');
				icon.classList.add('fa-moon');
			}
		});
	</script>

	<!-- Script para el manejo del modal de edición -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const modal = document.getElementById('editarForoModal');
			const closeBtn = document.querySelector('.close-modal');
			const formEditar = document.getElementById('formEditarForo');
			const editarTitulo = document.getElementById('editarTitulo');
			const editarDescripcion = document.getElementById('editarDescripcion');
			const editarForoId = document.getElementById('editarForoId');

			// Abrir modal de edición
			document.querySelectorAll('.btn-editar').forEach(btn => {
				btn.addEventListener('click', function() {
					const foroId = this.getAttribute('data-id');
					const titulo = this.getAttribute('data-titulo');
					const descripcion = this.getAttribute('data-descripcion');

					editarForoId.value = foroId;
					editarTitulo.value = titulo;
					editarDescripcion.value = descripcion;
					modal.style.display = 'block';
				});
			});

			// Cerrar modal
			closeBtn.addEventListener('click', function() {
				modal.style.display = 'none';
			});

			// Cerrar al hacer clic fuera del modal
			window.addEventListener('click', function(event) {
				if (event.target === modal) {
					modal.style.display = 'none';
				}
			});

			// Manejar envío del formulario
			formEditar.addEventListener('submit', function(e) {
				if (!editarTitulo.value.trim() || !editarDescripcion.value.trim()) {
					e.preventDefault();
					alert('Por favor complete todos los campos');
					return false;
				}
				return true;
			});
		});
	</script>

	<!-- Estilos para el modal y los botones de edición -->
	<style>
		/* Estilos para la lista de foros */
		.lista-foros {
			list-style: none;
			padding: 0;
		}

		.lista-foros li {
			background: #f9f9f9;
			padding: 15px;
			margin-bottom: 10px;
			border-radius: 8px;
			border-left: 4px solid #4CAF50;
			transition: all 0.3s ease;
		}

		.dark-mode .lista-foros li {
			background: #2d2d2d;
			border-left-color: #4CAF50;
		}

		.foro-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 8px;
		}

		.foro-actions {
			display: flex;
			gap: 5px;
		}

		.btn-editar {
			background: #4CAF50;
			color: white;
			border: none;
			padding: 5px 10px;
			border-radius: 4px;
			cursor: pointer;
			transition: background-color 0.3s;
		}

		.btn-editar:hover {
			background: #45a049;
		}

		/* Estilos del modal */
		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgba(0, 0, 0, 0.5);
		}

		.modal-content {
			background-color: #fff;
			margin: 10% auto;
			padding: 20px;
			border-radius: 8px;
			width: 90%;
			max-width: 600px;
			position: relative;
		}

		.dark-mode .modal-content {
			background-color: #2d2d2d;
			color: #fff;
		}

		.close-modal {
			position: absolute;
			right: 20px;
			top: 10px;
			font-size: 24px;
			cursor: pointer;
		}

		.form-group {
			margin-bottom: 15px;
		}

		.form-group label {
			display: block;
			margin-bottom: 5px;
		}

		.form-group input[type="text"],
		.form-group textarea {
			width: 100%;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
		}

		.dark-mode .form-group input[type="text"],
		.dark-mode .form-group textarea {
			background-color: #3d3d3d;
			color: #fff;
			border-color: #555;
		}

		.btn-guardar {
			background: #2196F3;
			color: white;
			border: none;
			padding: 8px 16px;
			border-radius: 4px;
			cursor: pointer;
			transition: background-color 0.3s;
		}

		.btn-guardar:hover {
			background: #0b7dda;
		}

		/* Mejoras de accesibilidad */
		button:focus {
			outline: 2px solid #4CAF50;
			outline-offset: 2px;
		}

		/* Mejoras para móviles */
		@media (max-width: 768px) {
			.foro-header {
				flex-direction: column;
				align-items: flex-start;
			}
			
			.foro-actions {
				margin-top: 8px;
				width: 100%;
			}
			
			.modal-content {
				width: 95%;
				margin: 20% auto;
			}
		}
	</style>
</body>

</html>